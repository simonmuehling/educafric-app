<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”” Test Notifications Educafric PWA</title>
    <link rel="icon" href="/educafric-logo-128.png">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #6366F1, #8B5CF6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        h1 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 28px;
        }
        p {
            color: #6b7280;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .btn {
            background: linear-gradient(45deg, #6366F1, #8B5CF6);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }
        .success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ðŸ””</div>
        <h1>Test Notifications PWA</h1>
        <p>Testez les notifications push natives de votre application Educafric</p>
        
        <button class="btn" onclick="requestPermission()">
            ðŸ”‘ Demander Permission
        </button>
        
        <button class="btn" onclick="sendTestNotifications()">
            ðŸ§ª Envoyer 3 Notifications Test
        </button>
        
        <div id="status"></div>
        
        <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 10px; text-align: left;">
            <h3 style="color: #374151; margin-top: 0;">ðŸ’¡ Instructions :</h3>
            <ol style="color: #6b7280; line-height: 1.8;">
                <li>Cliquez sur "Demander Permission" pour autoriser les notifications</li>
                <li>Cliquez sur "Envoyer 3 Notifications Test" pour recevoir les notifications</li>
                <li>Vous verrez 3 notifications espacÃ©es de 2 secondes</li>
                <li>Les notifications apparaÃ®tront mÃªme si vous changez d'onglet</li>
            </ol>
        </div>
    </div>

    <script>
        const updateStatus = (message, type = 'info') => {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        };

        const requestPermission = async () => {
            if (!('Notification' in window)) {
                updateStatus('âŒ Les notifications ne sont pas supportÃ©es par ce navigateur', 'error');
                return false;
            }
            
            if (Notification.permission === 'granted') {
                updateStatus('âœ… Permission dÃ©jÃ  accordÃ©e! Vous pouvez envoyer des notifications.', 'success');
                return true;
            }
            
            if (Notification.permission !== 'denied') {
                updateStatus('ðŸ”„ Demande de permission en cours...', 'info');
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    updateStatus('âœ… Permission accordÃ©e! Vous pouvez maintenant recevoir des notifications.', 'success');
                    return true;
                } else {
                    updateStatus('âŒ Permission refusÃ©e. Veuillez autoriser les notifications dans les paramÃ¨tres de votre navigateur.', 'error');
                    return false;
                }
            }
            
            updateStatus('âŒ Permission refusÃ©e. Veuillez autoriser les notifications dans les paramÃ¨tres de votre navigateur.', 'error');
            return false;
        };

        const sendNotification = (title, body, icon = '/educafric-logo-128.png') => {
            if (Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: icon,
                    badge: icon,
                    vibrate: [200, 100, 200],
                    requireInteraction: false
                });
                
                notification.onclick = () => {
                    console.log('ðŸ”” Notification cliquÃ©e:', title);
                    window.focus();
                    notification.close();
                };
                
                // Auto-fermer aprÃ¨s 6 secondes
                setTimeout(() => {
                    notification.close();
                }, 6000);
                
                return notification;
            } else {
                updateStatus('âŒ Permission non accordÃ©e pour les notifications', 'error');
                return null;
            }
        };

        const sendTestNotifications = async () => {
            if (Notification.permission !== 'granted') {
                updateStatus('âš ï¸ Permission requise! Cliquez d\'abord sur "Demander Permission".', 'error');
                return;
            }
            
            updateStatus('ðŸš€ Envoi de 3 notifications test...', 'info');
            
            // Notification 1
            setTimeout(() => {
                sendNotification(
                    'ðŸŽ‰ Test PWA Educafric',
                    'Votre application fonctionne parfaitement! Connexion stable, modules chargÃ©s.'
                );
            }, 500);
            
            // Notification 2
            setTimeout(() => {
                sendNotification(
                    'âš¡ Performance OptimisÃ©e',
                    '154 modules prÃ©chargÃ©s, cache intelligent actif, connexion PWA avancÃ©e.'
                );
            }, 2500);
            
            // Notification 3
            setTimeout(() => {
                sendNotification(
                    'âœ… SystÃ¨me Debug Complet',
                    'Tous les bugs critiques rÃ©solus. Votre PWA Educafric est prÃªte!'
                );
                
                // Message de confirmation finale
                setTimeout(() => {
                    updateStatus('ðŸŽ¯ 3 notifications envoyÃ©es avec succÃ¨s! Votre systÃ¨me PWA fonctionne parfaitement.', 'success');
                }, 1000);
            }, 4500);
        };

        // Test automatique des permissions au chargement
        window.addEventListener('load', () => {
            if (Notification.permission === 'granted') {
                updateStatus('âœ… Notifications activÃ©es! Cliquez sur "Envoyer 3 Notifications Test".', 'success');
            } else {
                updateStatus('ðŸ”” Cliquez sur "Demander Permission" pour activer les notifications.', 'info');
            }
        });
    </script>
</body>
</html>