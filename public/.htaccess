# Ensure proper MIME types for PWA resources
AddType application/manifest+json .webmanifest .json
AddType image/png .png
AddType image/jpeg .jpg .jpeg
AddType image/x-icon .ico
AddType application/javascript .js

# Enable rewrite engine
RewriteEngine On
RewriteBase /

# Serve real files and directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA fallback for everything else
RewriteRule . /index.html [L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Cache control for PWA resources
<FilesMatch "\.(png|jpg|jpeg|ico|webmanifest|json)$">
    Header set Cache-Control "public, max-age=86400"
</FilesMatch>

<FilesMatch "sw\.js$">
    Header set Cache-Control "no-cache"
    Header set Content-Type "application/javascript"
</FilesMatch>