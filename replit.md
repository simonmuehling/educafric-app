# Overview
Educafric is a mobile-first, bilingual Progressive Web App (PWA) EdTech platform designed for African educational institutions. It integrates academic administration, communication, and financial management using a Competency-Based Approach (CBA). The project aims to deliver user-friendly, scalable, and culturally relevant EdTech solutions, expand market reach, and enhance access to quality education across Africa.

# User Preferences
- ALWAYS consolidate ALL dashboards (Teacher, Student, Parent, Commercial, SiteAdmin) when making changes.
- NEVER make partial updates to only some dashboards.
- ALWAYS preserve button functionality when making changes - buttons must remain functional.
- DOCUMENTS MUST APPEAR INSTANTLY: User is frustrated that document creation takes hours - streamline to work immediately.
- ALL documents MUST be placed in `/public/documents` directory with lowercase kebab-case naming.
- Use consolidated EDUCAFRIC system for document creation:
    1. Create specialized PDF generator method in `server/services/pdfGenerator.ts`.
    2. Add document to commercial docs list in `server/routes.ts` (both view and download routes).
    3. Create HTML version in `/public/documents` for web viewing.
    4. Update alphabetical index in `00-index-documents-alphabetique.html`.
    5. Test via API routes `/api/commercial/documents/{id}/download` and direct HTML access.
- Le g√©n√©rateur PDF (`pdfGenerator.ts`) utilise un syst√®me de r√©solution hybride pour trouver les logos d'√©cole. Chemins test√©s: 1) Chemin normalis√©, 2) `public/` + chemin, 3) `public/uploads/logos/` + nom fichier, 4) `public/uploads/homework/` + nom fichier. Logs d√©taill√©s: `[PDF_LOGO] üîç Searching logo...`. Le formulaire de bulletin affiche un aper√ßu du logo + option d'upload manuel dans la section "Informations √âcole". Les logos sont stock√©s dans `public/uploads/homework/` avec noms format `school-{id}-{timestamp}.{ext}`.
- Le format GIF n'est PAS support√© par le g√©n√©rateur PDF (pdf-lib). SEULS les formats PNG et JPEG sont autoris√©s pour les logos d'√©cole. Validation c√¥t√© frontend (input accept + v√©rification file.type) ET c√¥t√© backend (multer fileFilter). Message d'erreur bilingue si tentative d'upload GIF: "Format GIF non support√©. Utilisez PNG ou JPEG pour que le logo apparaisse sur les bulletins PDF."
- PATTERN BILINGUE STANDARD: Utiliser hook `useLanguage()` avec objet `t` contenant `fr` et `en`. Pour √©tats vides: Card avec ic√¥ne (className="w-16 h-16 text-gray-300 mx-auto mb-4"), message FR/EN centr√©, texte gris. Pour chargement: Spinner avec texte "Chargement..."/"Loading...". Format: `{language === 'fr' ? 'Texte FR' : 'English text'}`.
- PATTERN ONGLETS RESPONSIFS MOBILE (STANDARD OBLIGATOIRE JANVIER 2026):
    - **TabsList**: `className="grid w-full grid-cols-X h-auto p-1.5 bg-[#F3F5F7] rounded-xl gap-1"`
    - **TabsTrigger**: `className="flex items-center justify-center gap-2 min-h-[44px] px-2 py-2 text-xs sm:text-sm data-[state=active]:bg-white data-[state=active]:text-[#7C5CFC] data-[state=active]:shadow-sm"`
    - **Labels texte**: `<span className="hidden lg:inline truncate">{label}</span>` (ic√¥nes seules sur mobile/tablette, ic√¥nes+texte sur desktop lg+)
    - **Ic√¥nes**: `className="w-4 h-4 flex-shrink-0"` (taille fixe, jamais shrink)
    - **Couleurs**: Fond gris clair #F3F5F7, onglet actif blanc avec texte violet #7C5CFC et ombre l√©g√®re
    - **Accessibilit√©**: min-h-[44px] pour touch targets selon WCAG 2.1
    - **MODULES CORRIG√âS (4 profils mobiles)**:
        - Director: AcademicManagementSuite (6 onglets), OnlineClassesManager (5), TeacherGradeReview (5), FeesManagement (5), SchoolAdministration (5), TeacherSubmittedBulletins (4), TeacherAbsenceManager (4)
        - Teacher: TeacherGradeSubmissionsList (5), FunctionalTeacherAssignments (4), TeacherOnlineClasses (3)
        - Student: StudentCommunications (4), FunctionalStudentProfile (3)
        - Parent: FunctionalParentProfile (3), ParentChildrenHomework (3), ParentCommunicationsBidirectional (3)
    - **R√àGLE**: Tout nouveau module avec 3+ onglets DOIT utiliser ce pattern. Copier-coller depuis un module existant.
- TITRE DASHBOARD NON DUPLIQU√â: Le titre et sous-titre du dashboard apparaissent UNIQUEMENT dans DashboardNavbar. NE JAMAIS ajouter de section titre dans le contenu principal (UnifiedIconDashboard). Le composant affiche directement la grille d'ic√¥nes sans titre r√©p√©t√©.
- COULEURS IC√îNES PR√âSERV√âES: Les ic√¥nes de modules conservent leurs couleurs distinctives originales (vert, violet, orange, rose, etc.). NE JAMAIS forcer toutes les ic√¥nes en violet - chaque module a sa couleur identitaire.
- S√âCURIT√â ARRAYS API: Toujours v√©rifier que les donn√©es retourn√©es par les APIs sont des tableaux avant d'appeler `.map()`. Pattern obligatoire: `const safeData = Array.isArray(data) ? data : [];` AVANT tout `.map()`, `.filter()`, `.length`. Ceci √©vite les erreurs "X.map is not function" quand l'API retourne undefined ou un objet au lieu d'un tableau.
- S√âLECTION CLASSES ABSENCE ENSEIGNANT: Dans le module TeacherAbsenceDeclaration.tsx, les classes s√©lectionn√©es ont un style visuel distinctif: `ring-2 ring-[#7C5CFC] ring-offset-2 bg-[#7C5CFC] shadow-md`. Ceci aide les enseignants assign√©s √† plusieurs √©coles √† identifier clairement les classes concern√©es par leur absence. Les classes non s√©lectionn√©es ont un hover violet subtil (`hover:border-[#7C5CFC] hover:text-[#7C5CFC]`).
- PARENT API RESPONSE STRUCTURE: Les endpoints parent retournent un objet `{success: boolean, children/homework/data: [...]}` et NON un tableau direct. Dans les composants React Query, TOUJOURS extraire les donn√©es: `const children = childrenResponse?.children || [];`. Endpoints concern√©s: `/api/parent/children`, `/api/parent/children/homework`. Pattern obligatoire dans useQuery: `queryFn: async () => { const data = await response.json(); return data.children || []; }`.
- QUICK ACTIONS PARENT NAVIGATION: Les Actions Rapides dans FunctionalParentChildren.tsx utilisent l'√©v√©nement `switchModule` pour naviguer vers les modules. Format: `window.dispatchEvent(new CustomEvent('switchModule', { detail: { moduleId: 'parent-homework' } }));`. Mapping des actions: Notes‚Üí`parent-homework`, Pr√©sences‚Üí`parent-attendance`, Messages‚Üí`parent-messages`, G√©olocalisation‚Üí`geolocation`. UnifiedIconDashboard √©coute cet √©v√©nement et switch le module. NE JAMAIS utiliser les anciens √©v√©nements (`switchToGrades`, `switchToAttendance`, etc.) - ils ne sont plus √©cout√©s.
- QR CODE G√âN√âRATION - FIX CRITIQUE: L'API `/api/student/generate-qr` retourne `shareUrl` (URL string) et `qrData` (objet JSON). Le frontend DOIT utiliser `data.shareUrl` pour g√©n√©rer le QR code, PAS `data.qrData` (qui est un objet et cause l'erreur "Invalid data"). L'API g√©n√®re dynamiquement l'URL avec le host de la requ√™te: `${protocol}://${host}/parent-connect?student=${user.id}&code=${connectionId}`. Pattern frontend: `const apiMagicLink = data.shareUrl || data.dynamicLink || fallbackUrl;`
- Le logo de l'√©cole DOIT √™tre r√©cup√©r√© depuis `/api/director/settings` (champ `school.logoUrl` ou `profile.logoUrl`) et stock√© dans `formData.schoolLogoUrl`. Tous les endroits g√©n√©rant des bulletins DOIVENT utiliser `formData.schoolLogoUrl` au lieu de donn√©es hardcod√©es. Le champ database est `schools.logoUrl` (pas `logo`). L'endpoint `PUT /api/school/logo` utilise `db.update(schools).set({ logoUrl: ... })` pour persister.
- MATI√àRES BILINGUES (FR/EN): Tous les modules affichent les mati√®res selon la langue s√©lectionn√©e. API retourne `nameFr` et `nameEn` pour chaque mati√®re. Frontend pattern: `language === 'fr' ? subject.nameFr : subject.nameEn`. NE JAMAIS utiliser uniquement `subject.name` - toujours v√©rifier la langue.
- LOGO EDUCAFRIC - AFFICHAGE WEB: Les pages Login.tsx et PasswordReset.tsx utilisent le chemin simple `/educafric-logo-128.png` pour afficher le logo. NE JAMAIS utiliser `window.location.origin` ou `crossOrigin` - cela cause des probl√®mes d'affichage. Le fichier logo est dans `/public/educafric-logo-128.png`. Pattern: `<img src="/educafric-logo-128.png" />` sans onError fallback complexe.
- ANDROID AAB BUILD - GITHUB ACTIONS: Le workflow `.github/workflows/android-build.yml` g√©n√®re les fichiers AAB pour Google Play Store. Configuration qui FONCTIONNE: Node.js 20, Java 17 (Temurin), android-actions/setup-android@v3. NE PAS cr√©er d'autres fichiers workflow Android - un seul suffit.
- ANDROID STABILIT√â (JANVIER 2026): Syst√®me complet de gestion d'erreurs pour l'app Android conforme aux exigences Google Play Store:
    - `GlobalErrorBoundary.tsx`: Capture toutes les erreurs React, d√©tection erreurs r√©seau/chunk, UI bilingue de r√©cup√©ration, clear QueryClient cache sur retry, suppression caches SW sur refresh
    - `networkMonitor.ts`: Surveillance connectivit√© r√©seau, √©v√©nements online/offline, reconnexion automatique, fonctions `isNetworkError()`, `isChunkLoadError()`, `shouldRetryRequest()`
    - `queryClient.ts`: Retry intelligent bas√© sur networkMonitor, exponential backoff (1s ‚Üí 10s max), skip retry si offline
    - IC√îNES: G√©n√©r√©es depuis `public/educafric-logo-512.png` via ImageMagick pour toutes les densit√©s (mdpi/hdpi/xhdpi/xxhdpi/xxxhdpi). Fond violet `#7C5CFC` pour adaptive icons.
    - VERSION: `versionCode` et `versionName` dans `android/app/build.gradle` + User-Agent dans `capacitor.config.ts`. Toujours incr√©menter avant soumission Play Store.

# System Architecture
- **UI/UX Decisions**: Mobile-first PWA with a consistent purple theme (`#7C5CFC`), using Radix UI, Shadcn/UI, and Tailwind CSS. Responsive tabs for mobile (icons only) and desktop (icons with text). Dashboard titles are managed by `DashboardNavbar` exclusively. Module icons retain distinct original colors. Student ID cards feature an official template with mobile-friendly color printing, digital signatures, and QR verification. Online course interfaces are always visible, with dynamic access rules and contextual prompts for restricted functions.
- **Technical Implementations**: Frontend built with React (TypeScript), Wouter, and TanStack Query. Backend uses Express.js RESTful API. Data is stored in PostgreSQL (Neon Serverless) with Drizzle ORM. Authentication relies on session-based `express-session`, `Passport.js`, and Firebase Google OAuth, implementing an 8-role-based access control (RBAC) model. Phone numbers are primary unique identifiers. The route architecture prioritizes internal routes and ensures strict segmentation of module mappings per dashboard. A centralized document generation system (`server/services/pdfGenerator.ts`) creates documents instantly, storing them in `/public/documents`. Academic bulletins are generated using an adaptive flexbox layout in `client/src/index.css`, optimized for print and `html2canvas`, dynamically incorporating school logos (PNG/JPEG with 4-level fallback). Android stability features `GlobalErrorBoundary.tsx`, `networkMonitor.ts`, and `queryClient.ts` for comprehensive error handling, connectivity monitoring, and intelligent retry logic. Homework attachments are supported via dedicated upload endpoints and JSONB storage.
- **Feature Specifications**: Real-time attendance, flexible timetable management, and multi-channel notifications (Email, WhatsApp, PWA). Supports bilingual templates and robust bulk Excel import. Key academic features include CBA bulletin generation and Jitsi Meet integration for online classes. Schools can define custom academic levels via API and UI. Dynamic online course access rules are based on teacher subscription status. Configurable parent subscription plans and automatic family discounts are managed by Site Administrators. Student messaging is restricted to parents for sending, while receiving from all other profiles is permitted. Automated homework creation and submission notifications with scheduled reminders, and a comprehensive student-parent connection workflow ensure secure linkages. Hierarchical archives provide organized access to past academic documents. Student photos are comprehensively mapped across various field aliases. Competencies are automatically imported into bulletins from the `competencies` table.
- **System Design Choices**: All storage modules exclusively use Drizzle ORM. Strict multi-tenancy is enforced with `user.schoolId`. Sandbox data is pre-seeded by idempotent scripts. A multi-role user management system (`role_affiliations`) includes existing user detection by email/phone. Development and production databases are completely separated. All "Contacter Educafric" buttons open WhatsApp with pre-filled messages to `237656200472`. Bulk teacher import uses a default password (`Educafric2024!`), assigns the 'Teacher' role, and employs `ON CONFLICT DO NOTHING`. The `enrollments` table is for student class registrations, and `parent_student_relations` manages parent-student linkages. Parent API responses consistently return objects containing the data. Subject synchronization across modules is handled via `PUT /api/classes/:classId`, with duplicate detection and extensive cache invalidation. Approved grades for multiple subjects are merged for bulletin display.

# External Dependencies
- **Neon Database**: Serverless PostgreSQL database.
- **Stripe**: Payment gateway.
- **Firebase**: Google OAuth authentication.
- **WhatsApp**: Direct API for notifications and communication.
- **Hostinger**: SMTP services for email notifications.
- **Jitsi Meet**: Video conferencing for online classes.