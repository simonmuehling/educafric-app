<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Offline Premium - Educafric</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .document {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 42px;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .header .subtitle {
            font-size: 20px;
            opacity: 0.95;
            margin-bottom: 10px;
        }
        .header .version {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 20px;
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            display: inline-block;
        }
        .nav-toc {
            background: #f8f9fa;
            padding: 30px 40px;
            border-bottom: 3px solid #e9ecef;
        }
        .nav-toc h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 22px;
        }
        .nav-toc ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        .nav-toc li a {
            color: #495057;
            text-decoration: none;
            padding: 8px 15px;
            display: block;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .nav-toc li a:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }
        .content {
            padding: 50px 40px;
        }
        .section {
            margin-bottom: 50px;
        }
        .section h2 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        .section h3 {
            color: #495057;
            font-size: 24px;
            margin: 25px 0 15px 0;
        }
        .section h4 {
            color: #6c757d;
            font-size: 18px;
            margin: 20px 0 10px 0;
        }
        .feature-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .feature-box h4 {
            color: #667eea;
            margin-top: 0;
        }
        .info-card {
            background: #e7f3ff;
            border: 2px solid #b3d9ff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .info-card strong {
            color: #0056b3;
        }
        .warning-card {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .success-card {
            background: #d4edda;
            border: 2px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin: 2px;
        }
        .badge-purple {
            background: #e9d8fd;
            color: #6b21a8;
        }
        .badge-gray {
            background: #e9ecef;
            color: #6c757d;
        }
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card h4 {
            color: #667eea;
            margin-top: 0;
        }
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        .footer {
            background: #f8f9fa;
            padding: 40px;
            text-align: center;
            border-top: 3px solid #e9ecef;
        }
        .footer p {
            color: #6c757d;
            margin: 5px 0;
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .document {
                box-shadow: none;
            }
            .nav-toc {
                display: none;
            }
        }
        @media (max-width: 768px) {
            .header h1 {
                font-size: 28px;
            }
            .content {
                padding: 30px 20px;
            }
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="document">
        <!-- Header -->
        <div class="header">
            <h1>üì± Guide Offline Premium</h1>
            <p class="subtitle">Syst√®me de Gestion Offline Premium pour Site Admin</p>
            <p class="subtitle">Documentation Technique et Guide d'Utilisation</p>
            <span class="version">Version 1.0.0 | Novembre 2025</span>
        </div>

        <!-- Table des Mati√®res -->
        <div class="nav-toc">
            <h2>üìã Table des Mati√®res</h2>
            <ul>
                <li><a href="#vue-ensemble">Vue d'ensemble</a></li>
                <li><a href="#fonctionnalites">Fonctionnalit√©s</a></li>
                <li><a href="#guide-utilisation">Guide d'Utilisation</a></li>
                <li><a href="#architecture">Architecture Technique</a></li>
                <li><a href="#api">API Endpoints</a></li>
                <li><a href="#troubleshooting">D√©pannage</a></li>
            </ul>
        </div>

        <!-- Contenu -->
        <div class="content">
            <!-- Section 1: Vue d'ensemble -->
            <div class="section" id="vue-ensemble">
                <h2>üìñ Vue d'ensemble</h2>
                
                <div class="info-card">
                    <h4>Qu'est-ce qu'Offline Premium?</h4>
                    <p>Le syst√®me <strong>Offline Premium</strong> permet au Site Admin d'activer ou de d√©sactiver l'acc√®s hors ligne premium pour chaque √©cole individuellement. Cette fonctionnalit√© offre aux √©coles la possibilit√© d'utiliser Educafric en mode hors ligne avec des capacit√©s √©tendues.</p>
                </div>

                <h3>Caract√©ristiques Principales</h3>
                <div class="grid-2">
                    <div class="card">
                        <h4>üéØ Gestion Centralis√©e</h4>
                        <p>Site Admin contr√¥le l'acc√®s depuis un dashboard unique</p>
                    </div>
                    <div class="card">
                        <h4>‚ö° Toggle Instantan√©</h4>
                        <p>Activation/d√©sactivation en un seul clic</p>
                    </div>
                    <div class="card">
                        <h4>üí∞ Gratuit pour les √âcoles</h4>
                        <p>Pas de frais d'abonnement, option toggleable par Site Admin</p>
                    </div>
                    <div class="card">
                        <h4>üåê Bilingue FR/EN</h4>
                        <p>Interface compl√®te en Fran√ßais et Anglais</p>
                    </div>
                    <div class="card">
                        <h4>üîí S√©curis√©</h4>
                        <p>Authentification Site Admin requise</p>
                    </div>
                    <div class="card">
                        <h4>üîÑ Temps R√©el</h4>
                        <p>Mise √† jour imm√©diate sans rechargement de page</p>
                    </div>
                </div>

                <div class="success-card">
                    <h4>‚úÖ √âcoles avec Offline Premium Activ√© (Exemple)</h4>
                    <p>Actuellement, <strong>3 √©coles</strong> b√©n√©ficient de l'Offline Premium:</p>
                    <ol>
                        <li><strong>Lyc√©e Bilingue de Yaound√©</strong> (ID: 1)</li>
                        <li><strong>√âcole Primaire Bilingue Excellence</strong> (ID: 3)</li>
                        <li><strong>Government Technical High School Kumbo</strong> (ID: 10)</li>
                    </ol>
                </div>
            </div>

            <!-- Section 2: Fonctionnalit√©s -->
            <div class="section" id="fonctionnalites">
                <h2>‚öôÔ∏è Fonctionnalit√©s</h2>

                <div class="feature-box">
                    <h4>1. Affichage du Statut</h4>
                    <ul>
                        <li><strong>Badge color√©</strong> dans la liste des √©coles:
                            <ul>
                                <li><span class="badge badge-purple">Offline Premium Activ√©</span> - Badge violet pour les √©coles avec acc√®s premium</li>
                                <li><span class="badge badge-gray">Offline Premium D√©sactiv√©</span> - Badge gris pour les √©coles sans acc√®s</li>
                            </ul>
                        </li>
                        <li><strong>Mise √† jour en temps r√©el</strong>: Changement imm√©diat apr√®s toggle</li>
                    </ul>
                </div>

                <div class="feature-box">
                    <h4>2. Gestion via Modal</h4>
                    <ul>
                        <li><strong>Acc√®s</strong>: Clic sur l'ic√¥ne CreditCard (üí≥) dans la ligne de l'√©cole</li>
                        <li><strong>Interface</strong>: Modal simplifi√©e avec Switch toggle Shadcn</li>
                        <li><strong>Action</strong>: Activation/d√©sactivation en un clic</li>
                        <li><strong>Feedback</strong>: Message de confirmation bilingue (FR/EN)</li>
                    </ul>
                </div>

                <div class="feature-box">
                    <h4>3. S√©curit√©</h4>
                    <ul>
                        <li><strong>Authentification</strong>: Seuls les Site Admins peuvent acc√©der</li>
                        <li><strong>Validation</strong>: Param√®tre `enabled` doit √™tre boolean</li>
                        <li><strong>Logs</strong>: Toutes les actions sont logg√©es avec timestamp et utilisateur</li>
                    </ul>
                </div>

                <div class="feature-box">
                    <h4>4. Capacit√©s Offline Premium</h4>
                    <p>Lorsqu'une √©cole a Offline Premium activ√©, ses utilisateurs b√©n√©ficient de:</p>
                    <ul>
                        <li><strong>Directors/Parents</strong>: Acc√®s hors ligne pendant 14 jours</li>
                        <li><strong>Teachers/Students</strong>: Acc√®s hors ligne illimit√©</li>
                        <li><strong>CRUD complet</strong>: 5 modules (Students, Attendance, Classes, Teachers, Messages)</li>
                        <li><strong>Lecture seule</strong>: 7 modules (Schedule, Reports, Academic Management, Canteen, Bus, etc.)</li>
                        <li><strong>Synchronisation</strong>: Sync automatique au retour en ligne</li>
                    </ul>
                </div>
            </div>

            <!-- Section 3: Guide d'Utilisation -->
            <div class="section" id="guide-utilisation">
                <h2>üìò Guide d'Utilisation</h2>

                <h3>Pour le Site Admin</h3>

                <div class="feature-box">
                    <h4>√âtape 1: Acc√©der au Dashboard</h4>
                    <ol>
                        <li>Se connecter en tant que Site Admin</li>
                        <li>Naviguer vers "<strong>Gestion des √âcoles</strong>"</li>
                        <li>La liste des √©coles s'affiche avec badges de statut</li>
                    </ol>
                </div>

                <div class="feature-box">
                    <h4>√âtape 2: Activer Offline Premium</h4>
                    <ol>
                        <li>Localiser l'√©cole dans la liste</li>
                        <li>Cliquer sur l'ic√¥ne <strong>CreditCard (üí≥)</strong> dans la colonne "Actions"</li>
                        <li>Le modal "Offline Premium" s'ouvre</li>
                        <li>Activer le <strong>Switch toggle</strong> (OFF ‚Üí ON)</li>
                        <li>Confirmation automatique: <span class="badge badge-success">"Offline Premium activ√© avec succ√®s"</span></li>
                        <li>Le badge devient <span class="badge badge-purple">violet</span> dans la liste</li>
                    </ol>
                </div>

                <div class="feature-box">
                    <h4>√âtape 3: D√©sactiver Offline Premium</h4>
                    <ol>
                        <li>Localiser l'√©cole dans la liste</li>
                        <li>Cliquer sur l'ic√¥ne <strong>CreditCard (üí≥)</strong></li>
                        <li>D√©sactiver le <strong>Switch toggle</strong> (ON ‚Üí OFF)</li>
                        <li>Confirmation automatique: <span class="badge badge-success">"Offline Premium d√©sactiv√© avec succ√®s"</span></li>
                        <li>Le badge devient <span class="badge badge-gray">gris</span> dans la liste</li>
                    </ol>
                </div>

                <div class="warning-card">
                    <h4>‚ö†Ô∏è Note Importante</h4>
                    <p><strong>Les √©coles ne paient PAS pour Offline Premium.</strong> Il s'agit d'une option gratuite que le Site Admin peut activer ou d√©sactiver √† tout moment selon les besoins de l'√©cole.</p>
                </div>
            </div>

            <!-- Section 4: Architecture Technique -->
            <div class="section" id="architecture">
                <h2>üèóÔ∏è Architecture Technique</h2>

                <h3>Stack Technologique</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Composant</th>
                            <th>Technologie</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Frontend Framework</strong></td>
                            <td>React + TypeScript</td>
                        </tr>
                        <tr>
                            <td><strong>UI Components</strong></td>
                            <td>Shadcn/UI (Radix UI + Tailwind CSS)</td>
                        </tr>
                        <tr>
                            <td><strong>State Management</strong></td>
                            <td>TanStack Query v5</td>
                        </tr>
                        <tr>
                            <td><strong>Backend Framework</strong></td>
                            <td>Express.js</td>
                        </tr>
                        <tr>
                            <td><strong>ORM</strong></td>
                            <td>Drizzle ORM</td>
                        </tr>
                        <tr>
                            <td><strong>Database</strong></td>
                            <td>PostgreSQL (Neon Serverless)</td>
                        </tr>
                        <tr>
                            <td><strong>Authentication</strong></td>
                            <td>Express Session + Passport.js</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Structure Database</h3>
                <div class="code-block">
-- Table: schools
-- Colonne: offline_premium_enabled

ALTER TABLE schools 
ADD COLUMN offline_premium_enabled BOOLEAN NOT NULL DEFAULT FALSE;

COMMENT ON COLUMN schools.offline_premium_enabled IS 
'Offline Premium feature toggle (free for all schools, managed by Site Admin)';

-- Index pour recherche rapide
CREATE INDEX idx_schools_offline_premium 
ON schools(offline_premium_enabled);
                </div>

                <h3>Flux de Donn√©es</h3>
                <div class="info-card">
                    <ol>
                        <li><strong>Site Admin UI</strong> ‚Üí Affiche liste des √©coles avec badges</li>
                        <li><strong>TanStack Query</strong> ‚Üí GET /api/siteadmin/schools (r√©cup√®re la liste)</li>
                        <li><strong>Express API</strong> ‚Üí Authentifie et retourne les donn√©es</li>
                        <li><strong>Storage Layer</strong> ‚Üí Ex√©cute requ√™te Drizzle ORM</li>
                        <li><strong>PostgreSQL</strong> ‚Üí Retourne donn√©es avec offlinePremiumEnabled</li>
                        <li><strong>UI</strong> ‚Üí Affiche badge color√© selon statut</li>
                        <li><strong>Toggle Switch</strong> ‚Üí PATCH /api/siteadmin/schools/:id/offline-premium</li>
                        <li><strong>Database Update</strong> ‚Üí Mise √† jour imm√©diate</li>
                        <li><strong>Cache Invalidation</strong> ‚Üí Rafra√Æchissement automatique de la liste</li>
                    </ol>
                </div>
            </div>

            <!-- Section 5: API Endpoints -->
            <div class="section" id="api">
                <h2>üîå API Endpoints</h2>

                <h3>1. GET /api/siteadmin/schools</h3>
                <div class="feature-box">
                    <h4>Description</h4>
                    <p>R√©cup√®re la liste de toutes les √©coles avec leur statut Offline Premium.</p>
                    
                    <h4>Authentification</h4>
                    <p><span class="badge badge-purple">Requise</span> - R√¥le: Site Admin uniquement</p>

                    <h4>Query Parameters (optionnels)</h4>
                    <ul>
                        <li><code>search</code>: Recherche par nom, adresse, directeur</li>
                        <li><code>type</code>: Filtre par type ('public' | 'private' | 'all')</li>
                        <li><code>page</code>: Num√©ro de page (d√©faut: 1)</li>
                        <li><code>limit</code>: R√©sultats par page (d√©faut: 20)</li>
                    </ul>

                    <h4>Exemple de R√©ponse (200 OK)</h4>
                    <div class="code-block">
{
  "schools": [
    {
      "id": 1,
      "name": "Lyc√©e Bilingue de Yaound√©",
      "location": "Yaound√©, Cameroun",
      "type": "public",
      "studentCount": 850,
      "teacherCount": 45,
      "offlinePremiumEnabled": true,
      "director": "Jean Mbarga",
      "educafricNumber": "EDU-CM-SC-001"
    }
  ],
  "totalCount": 13,
  "page": 1,
  "limit": 20
}
                    </div>
                </div>

                <h3>2. PATCH /api/siteadmin/schools/:schoolId/offline-premium</h3>
                <div class="feature-box">
                    <h4>Description</h4>
                    <p>Active ou d√©sactive Offline Premium pour une √©cole sp√©cifique.</p>
                    
                    <h4>Authentification</h4>
                    <p><span class="badge badge-purple">Requise</span> - R√¥le: Site Admin uniquement</p>

                    <h4>Path Parameters</h4>
                    <ul>
                        <li><code>schoolId</code>: ID de l'√©cole (number)</li>
                    </ul>

                    <h4>Request Body</h4>
                    <div class="code-block">
{
  "enabled": true  // true = activer, false = d√©sactiver
}
                    </div>

                    <h4>Exemple de R√©ponse (200 OK)</h4>
                    <div class="code-block">
{
  "success": true,
  "message": "Offline Premium activ√© avec succ√®s",
  "messageFr": "Offline Premium activ√© avec succ√®s",
  "messageEn": "Offline Premium enabled successfully",
  "schoolId": 1,
  "offlinePremiumEnabled": true
}
                    </div>

                    <h4>Erreur de Validation (400)</h4>
                    <div class="code-block">
{
  "success": false,
  "message": "Invalid request: enabled must be a boolean"
}
                    </div>
                </div>
            </div>

            <!-- Section 6: Troubleshooting -->
            <div class="section" id="troubleshooting">
                <h2>üîß D√©pannage</h2>

                <h3>Probl√®me 1: Badge ne s'affiche pas</h3>
                <div class="feature-box">
                    <h4>Sympt√¥me</h4>
                    <p>Le badge Offline Premium n'appara√Æt pas dans la liste des √©coles.</p>
                    
                    <h4>Solutions</h4>
                    <ol>
                        <li>V√©rifier que l'API retourne bien <code>offlinePremiumEnabled</code></li>
                        <li>Rafra√Æchir le cache du navigateur (Ctrl+F5)</li>
                        <li>V√©rifier la console pour erreurs JavaScript</li>
                        <li>D√©connexion/reconnexion en tant que Site Admin</li>
                    </ol>
                </div>

                <h3>Probl√®me 2: Toggle ne fonctionne pas</h3>
                <div class="feature-box">
                    <h4>Sympt√¥me</h4>
                    <p>Le Switch toggle ne change pas le statut.</p>
                    
                    <h4>Solutions</h4>
                    <ol>
                        <li>V√©rifier la connexion internet</li>
                        <li>V√©rifier les logs console backend pour erreurs</li>
                        <li>S'assurer d'avoir les droits Site Admin</li>
                        <li>V√©rifier que l'√©cole existe dans la database</li>
                    </ol>
                </div>

                <h3>Probl√®me 3: Erreur 401 Unauthorized</h3>
                <div class="feature-box">
                    <h4>Sympt√¥me</h4>
                    <p>Impossible d'acc√©der √† l'endpoint malgr√© connexion.</p>
                    
                    <h4>Solutions</h4>
                    <ol>
                        <li>V√©rifier le r√¥le de l'utilisateur (doit √™tre 'SiteAdmin')</li>
                        <li>Se d√©connecter et se reconnecter</li>
                        <li>V√©rifier la session active</li>
                        <li>Contacter un administrateur syst√®me</li>
                    </ol>
                </div>

                <h3>Requ√™tes SQL Utiles</h3>
                <div class="code-block">
-- Compter les √©coles avec Offline Premium
SELECT 
  COUNT(*) FILTER (WHERE offline_premium_enabled = true) as enabled_count,
  COUNT(*) FILTER (WHERE offline_premium_enabled = false) as disabled_count,
  COUNT(*) as total_count
FROM schools;

-- Lister les √©coles avec Offline Premium activ√©
SELECT id, name, educafric_number, offline_premium_enabled
FROM schools
WHERE offline_premium_enabled = true
ORDER BY name ASC;
                </div>
            </div>

            <!-- Section 7: Contact et Support -->
            <div class="section">
                <h2>üìû Support et Contact</h2>
                <div class="info-card">
                    <h4>Besoin d'aide?</h4>
                    <ul>
                        <li><strong>Email Support:</strong> support@educafric.com</li>
                        <li><strong>Documentation:</strong> /docs/OFFLINE_PREMIUM_SITE_ADMIN.md</li>
                        <li><strong>Assistance Technique:</strong> Contacter l'√©quipe d√©veloppement Educafric</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>EDUCAFRIC</strong> - Plateforme de Gestion √âducative</p>
            <p>Guide Offline Premium - Version 1.0.0</p>
            <p>Derni√®re mise √† jour: Novembre 2025</p>
            <p>¬© 2025 Educafric. Tous droits r√©serv√©s.</p>
        </div>
    </div>
</body>
</html>
